# -----------------------------------------------------
# DEV ENV
# -----------------------------------------------------

# Local user bin
export PATH="$HOME/.local/bin:$PATH"

# -----------------------------------------------------
# Python
# -----------------------------------------------------

# ---- pyenv ----
export PYENV_ROOT="$HOME/.pyenv"
export PATH="$PYENV_ROOT/bin:$PATH"
eval "$(pyenv init -)"

# ---- conda (AFTER pyenv) ----
if [ -f /opt/miniconda3/etc/profile.d/conda.sh ]; then
  . /opt/miniconda3/etc/profile.d/conda.sh
  if [ -n "$CONDA_PREFIX" ]; then
    # Ensure conda bin comes before pyenv shims when active
    export PATH="$CONDA_PREFIX/bin:$PATH"
  fi
fi

# -----------------------------------------------------
# Language runtimes
# -----------------------------------------------------
export JAVA_HOME="/usr/lib/jvm/java-21-openjdk"
export PATH="$JAVA_HOME/bin:$PATH"

# -----------------------------------------------------
# Apache Arrow
# -----------------------------------------------------
if [ -n "$CONDA_PREFIX" ]; then
  export ARROW_HOME="$CONDA_PREFIX"
fi

export ARROW_PROJECT="$HOME/PycharmProjects/arrow"
export PARQUET_TEST_DATA="$ARROW_PROJECT/cpp/submodules/parquet-testing/data"
export ARROW_TEST_DATA="$ARROW_PROJECT/testing/data"

# -----------------------------------------------------
# Homebrew
# -----------------------------------------------------
if [ -x /home/linuxbrew/.linuxbrew/bin/brew ]; then
  eval "$(/home/linuxbrew/.linuxbrew/bin/brew shellenv)"
fi

# -----------------------------------------------------
# Node
# -----------------------------------------------------

# Bun
[ -s "$HOME/.bun/_bun" ] && source "$HOME/.bun/_bun"
export BUN_INSTALL="$HOME/.bun"
export PATH="$BUN_INSTALL/bin:$PATH"

# PATH exports (additive)
export PNPM_HOME="$HOME/.local/share/pnpm"
export PATH="$PNPM_HOME:$PATH"

# NVM (Arch)
if [ -f /usr/share/nvm/init-nvm.sh ]; then
  source /usr/share/nvm/init-nvm.sh
  nvm use default >/dev/null
fi

# Corepack
if command -v corepack >/dev/null; then
  corepack enable
  corepack prepare pnpm@latest --activate >/dev/null 2>&1
fi

# Final confirmation (interactive only)
if [[ -o interactive ]]; then
  echo ">>> Node profile loaded"
  if command -v nvm >/dev/null; then
    echo ">>> nvm: $(nvm current)"
  fi
  if command -v node >/dev/null; then
    echo ">>> node: $(node -v)"
    echo ">>> node path: $(command -v node)"
  fi
  echo ">>> corepack: $(command -v corepack 2>/dev/null || echo not found)"
fi



# VSCODE
[[ "$TERM_PROGRAM" == "vscode" ]] && . "$(code --locate-shell-integration-path zsh)"
